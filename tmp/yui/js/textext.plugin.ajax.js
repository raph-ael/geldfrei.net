(function(i){function l(){}i.fn.textext.TextExtAjax=l;i.fn.textext.addPlugin("ajax",l);var b=l.prototype,g="ajax.data.callback",k="ajax.cache.results",f="ajax.loading.delay",j="ajax.loading.message",d="ajax.type.delay",c="setSuggestions",h="showDropdown",a="loading",e={ajax:{typeDelay:0.5,loadingMessage:"Loading...",loadingDelay:0.5,cacheResults:false,dataCallback:null}};b.init=function(m){var n=this;n.baseInit(m,e);n.on({getSuggestions:n.onGetSuggestions});n._suggestions=null};b.load=function(p){var m=this,n=m.opts(g)||function(q){return{q:q}},o;o=i.extend(true,{data:n(p),success:function(q){m.onComplete(q,p)},error:function(r,q){console.error(q,p)}},m.opts("ajax"));i.ajax(o)};b.onComplete=function(p,o){var n=this,m=p;n.dontShowLoading();if(n.opts(k)==true){n._suggestions=p;m=n.itemManager().filter(p,o)}n.trigger(c,{result:m})};b.dontShowLoading=function(){this.stopTimer(a)};b.showLoading=function(){var m=this;m.dontShowLoading();m.startTimer(a,m.opts(f),function(){m.trigger(h,function(o){o.clearItems();var n=o.addDropdownItem(m.opts(j));n.addClass("text-loading")})})};b.onGetSuggestions=function(q,p){var n=this,m=n._suggestions,o=(p||{}).query||"";if(m&&n.opts(k)===true){return n.onComplete(m,o)}n.startTimer("ajax",n.opts(d),function(){n.showLoading();n.load(o)})}})(jQuery);